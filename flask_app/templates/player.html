{% extends "base.html" %}

{% block title %}{{ player_name }}'s Stats{% endblock %}
{% block body_class %}page-player{% endblock %}

{% block content %}
<div class="player-header">
    <h1>{{ full_name if full_name else player_name }}</h1>

    {% if image_exists %}
        <img src="{{ url_for('static', filename='player_pics/' + player_name + '.png') }}"
             alt="{{ player_name }}'s photo" width="180">
    {% endif %}
</div>

{% if position %}
    <p class="player-meta">{{ position }}</p>
{% endif %}
{% if height_str %}
    <p class="player-meta">{{ height_str }}</p>
{% endif %}
{% if birthday %}
    <p class="player-meta">{{ birthday }}</p>
{% endif %}

<h3>RAPM Rating</h3>
{% if player_rating %}
    {% set values_list = player_rating[0].values() | list %}
    <h3>{{ values_list[1] }}</h3>
{% else %}
    <p>No rating data available for {{ player_name }} (not yet played 20 games).</p>
{% endif %}

<!-- Navigation Tabs -->
<div class="tabs">
    <div class="tab active" data-target="stats">Stats</div>
    <div class="tab" data-target="days">Days</div>
    <div class="tab" data-target="games">Games</div>
    <div class="tab" data-target="player_pairings">Player Pairings</div>
</div>

<!-- Min games filter, shared with index (will apply to Stats + Pairings) -->
<input id="minGamesPlayed" type="number" placeholder="Filter Min Games" oninput="filterByMinGamesPlayed()">

<div class="tab-content stats active">
    <h2>Stats</h2>
    {% if player_stats %}
    <table id="statsTable" class="wide-table" data-page-table="player-stats">
        <thead>
        <tr>
            {% for col in player_stats[0].keys() %}
                <th title="{{ main_tooltip.get(col, '') }}">{{ col }}</th>
            {% endfor %}
        </tr>
        </thead>
        <tbody>
        {% for row in player_stats %}
            <tr>
                {% for key, value in row.items() %}
                    <td>
                        {% if key == "Most Recent Game" %}
                            <a href="{{ url_for('date_page', date=value) }}">{{ value }}</a>
                        {% else %}
                            {{ value }}
                        {% endif %}
                    </td>
                {% endfor %}
            </tr>
        {% endfor %}
        </tbody>
    </table>
    {% else %}
        <p>No stats available for {{ player_name }}.</p>
    {% endif %}

    <div class="graph-container">
        {{ player_games_rolling_html | safe }}
    </div>
</div>

<div class="tab-content days">
    <h2>Days</h2>
    {% if player_days %}
    <table id="daysTable" class="wide-table">
        <thead>
        <tr>
            {% for col in player_days[0].keys() %}
                <th title="{{ main_tooltip.get(col, '') }}">{{ col }}</th>
            {% endfor %}
        </tr>
        </thead>
        <tbody>
        {% for row in player_days %}
            <tr>
                {% for key, value in row.items() %}
                    <td>
                        {% if key == "Game Date" %}
                            <a href="{{ url_for('date_page', date=value) }}">{{ value }}</a>
                        {% else %}
                            {{ value }}
                        {% endif %}
                    </td>
                {% endfor %}
            </tr>
        {% endfor %}
        </tbody>
    </table>
    {% else %}
        <p>No days data available.</p>
    {% endif %}
</div>

<div class="tab-content games">
    <h2>All Games</h2>
    {% if player_games %}
    <table id="gamesTable" class="wide-table" data-page-table="player-games">
        <thead>
        <tr>
            {% for col in player_games[0].keys() %}
                <th title="{{ main_tooltip.get(col, '') }}">{{ col }}</th>
            {% endfor %}
        </tr>
        </thead>
        <tbody>
        {% for row in player_games %}
            <tr>
                {% for key, value in row.items() %}
                    <td>
                        {% if key in ['T1', 'T2', 'T3', 'T4', 'O1', 'O2', 'O3', 'O4', 'O5'] %}
                            <a href="{{ url_for('player_page', player_name=value) }}">{{ value }}</a>
                        {% elif key == "Game Date" %}
                            <a href="{{ url_for('date_page', date=value) }}">{{ value }}</a>
                        {% else %}
                            {{ value }}
                        {% endif %}
                    </td>
                {% endfor %}
            </tr>
        {% endfor %}
        </tbody>
    </table>
    {% else %}
        <p>No games found for {{ player_name }}.</p>
    {% endif %}
</div>

<div class="tab-content player_pairings">
    <h2>Player Pairings</h2>

    <h3>Teammate Combos</h3>
    {% if player_teammates %}
    <table id="teammatesTable" class="wide-table">
        <thead>
        <tr>
            {% for col in player_teammates[0].keys() %}
                <th title="{{ main_tooltip.get(col, '') }}">{{ col }}</th>
            {% endfor %}
        </tr>
        </thead>
        <tbody>
        {% for row in player_teammates %}
            <tr>
                {% for key, value in row.items() %}
                    {% if key == "Teammate" %}
                        <td>
                            <a href="{{ url_for('player_page', player_name=value) }}">{{ value }}</a>
                        </td>
                    {% else %}
                        <td>{{ value }}</td>
                    {% endif %}
                {% endfor %}
            </tr>
        {% endfor %}
        </tbody>
    </table>
    {% else %}
        <p>No teammate data available.</p>
    {% endif %}

    <h3>Opponent Combos</h3>
    {% if player_oppponents %}
    <table id="opponentsTable" class="wide-table">
        <thead>
        <tr>
            {% for col in player_oppponents[0].keys() %}
                <th title="{{ main_tooltip.get(col, '') }}">{{ col }}</th>
            {% endfor %}
        </tr>
        </thead>
        <tbody>
        {% for row in player_oppponents %}
            <tr>
                {% for key, value in row.items() %}
                    {% if key == "Opp" %}
                        <td>
                            <a href="{{ url_for('player_page', player_name=value) }}">{{ value }}</a>
                        </td>
                    {% else %}
                        <td>{{ value }}</td>
                    {% endif %}
                {% endfor %}
            </tr>
        {% endfor %}
        </tbody>
    </table>
    {% else %}
        <p>No opponent data available.</p>
    {% endif %}
</div>

<br>
<a href="{{ url_for('home') }}">Back to Home</a>
{% endblock %}
